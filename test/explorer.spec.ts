import { describe, it, expect, vi, beforeEach } from "vitest";
import { Tx } from "cosmjs-types/cosmos/tx/v1beta1/tx";
import { toHex } from "@cosmjs/encoding";
import { sha256 } from "@cosmjs/crypto";
import { getClient, parseTransaction, getTransactionData } from "../composables/useExplorer";

const rpcEndpoint = "https://go.getblock.io/65ef9c5d71c1477bb8cd6afa3bcd09ec"

vi.mock("#app", () => ({
  useRuntimeConfig: vi.fn(() => ({
    public: { rpcEndpoint: rpcEndpoint },
  })),
}));

describe("Cosmos Transaction Utilities", () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  describe("getClient", () => {
    it("should return a StargateClient instance", async () => {
      const client = await getClient()
      expect(await client.getChainId() === 'cosmoshub-4')

      const block = await client.getBlock(23574728)
      expect(block.id === '695DB0374621AFE69F69DBB5A8FBB1E262CA3579291BDC655C9F67B1D867C316')

      expect(JSON.stringify(block) === `{"id":"695DB0374621AFE69F69DBB5A8FBB1E262CA3579291BDC655C9F67B1D867C316","header":{"version":{"block":"11","app":"0"},"height":23574728,"chainId":"cosmoshub-4","time":"2024-12-19T02:31:19.635779163Z"},"txs":[{"0":10,"1":193,"2":1,"3":10,"4":190,"5":1,"6":10,"7":41,"8":47,"9":105,"10":98,"11":99,"12":46,"13":97,"14":112,"15":112,"16":108,"17":105,"18":99,"19":97,"20":116,"21":105,"22":111,"23":110,"24":115,"25":46,"26":116,"27":114,"28":97,"29":110,"30":115,"31":102,"32":101,"33":114,"34":46,"35":118,"36":49,"37":46,"38":77,"39":115,"40":103,"41":84,"42":114,"43":97,"44":110,"45":115,"46":102,"47":101,"48":114,"49":18,"50":144,"51":1,"52":10,"53":8,"54":116,"55":114,"56":97,"57":110,"58":115,"59":102,"60":101,"61":114,"62":18,"63":12,"64":99,"65":104,"66":97,"67":110,"68":110,"69":101,"70":108,"71":45,"72":49,"73":50,"74":54,"75":54,"76":26,"77":14,"78":10,"79":5,"80":117,"81":97,"82":116,"83":111,"84":109,"85":18,"86":5,"87":49,"88":48,"89":48,"90":48,"91":48,"92":34,"93":45,"94":99,"95":111,"96":115,"97":109,"98":111,"99":115,"100":49,"101":119,"102":120,"103":99,"104":51,"105":117,"106":100,"107":55,"108":101,"109":50,"110":121,"111":55,"112":121,"113":48,"114":104,"115":121,"116":112,"117":121,"118":56,"119":53,"120":118,"121":56,"122":114,"123":110,"124":117,"125":54,"126":54,"127":52,"128":101,"129":52,"130":107,"131":100,"132":52,"133":121,"134":54,"135":102,"136":120,"137":121,"138":112,"139":42,"140":43,"141":101,"142":108,"143":121,"144":115,"145":49,"146":119,"147":120,"148":99,"149":51,"150":117,"151":100,"152":55,"153":101,"154":50,"155":121,"156":55,"157":121,"158":48,"159":104,"160":121,"161":112,"162":121,"163":56,"164":53,"165":118,"166":56,"167":114,"168":110,"169":117,"170":54,"171":54,"172":52,"173":101,"174":52,"175":107,"176":100,"177":52,"178":121,"179":54,"180":115,"181":112,"182":102,"183":114,"184":50,"185":0,"186":56,"187":128,"188":156,"189":209,"190":211,"191":147,"192":239,"193":156,"194":137,"195":24,"196":18,"197":103,"198":10,"199":80,"200":10,"201":70,"202":10,"203":31,"204":47,"205":99,"206":111,"207":115,"208":109,"209":111,"210":115,"211":46,"212":99,"213":114,"214":121,"215":112,"216":116,"217":111,"218":46,"219":115,"220":101,"221":99,"222":112,"223":50,"224":53,"225":54,"226":107,"227":49,"228":46,"229":80,"230":117,"231":98,"232":75,"233":101,"234":121,"235":18,"236":35,"237":10,"238":33,"239":3,"240":63,"241":84,"242":229,"243":188,"244":84,"245":118,"246":149,"247":140,"248":98,"249":37,"250":138,"251":116,"252":212,"253":74,"254":144,"255":157,"256":65,"257":189,"258":122,"259":9,"260":229,"261":103,"262":118,"263":15,"264":76,"265":175,"266":180,"267":128,"268":226,"269":92,"270":81,"271":175,"272":18,"273":4,"274":10,"275":2,"276":8,"277":127,"278":24,"279":9,"280":18,"281":19,"282":10,"283":13,"284":10,"285":5,"286":117,"287":97,"288":116,"289":111,"290":109,"291":18,"292":4,"293":49,"294":48,"295":54,"296":53,"297":16,"298":176,"299":234,"300":10,"301":26,"302":64,"303":6,"304":248,"305":246,"306":246,"307":46,"308":168,"309":95,"310":156,"311":187,"312":99,"313":187,"314":122,"315":77,"316":189,"317":183,"318":235,"319":234,"320":69,"321":253,"322":123,"323":198,"324":58,"325":164,"326":115,"327":190,"328":227,"329":75,"330":194,"331":166,"332":201,"333":176,"334":105,"335":73,"336":42,"337":216,"338":5,"339":199,"340":50,"341":168,"342":143,"343":99,"344":4,"345":158,"346":35,"347":240,"348":21,"349":235,"350":188,"351":190,"352":174,"353":152,"354":134,"355":150,"356":133,"357":245,"358":139,"359":219,"360":159,"361":120,"362":22,"363":86,"364":20,"365":94,"366":252},{"0":10,"1":184,"2":1,"3":10,"4":158,"5":1,"6":10,"7":35,"8":47,"9":99,"10":111,"11":115,"12":109,"13":111,"14":115,"15":46,"16":115,"17":116,"18":97,"19":107,"20":105,"21":110,"22":103,"23":46,"24":118,"25":49,"26":98,"27":101,"28":116,"29":97,"30":49,"31":46,"32":77,"33":115,"34":103,"35":68,"36":101,"37":108,"38":101,"39":103,"40":97,"41":116,"42":101,"43":18,"44":119,"45":10,"46":45,"47":99,"48":111,"49":115,"50":109,"51":111,"52":115,"53":49,"54":48,"55":102,"56":106,"57":112,"58":114,"59":97,"60":118,"61":100,"62":57,"63":118,"64":102,"65":116,"66":100,"67":50,"68":115,"69":112,"70":112,"71":53,"72":115,"73":106,"74":107,"75":97,"76":118,"77":107,"78":100,"79":104,"80":53,"81":120,"82":56,"83":110,"84":120,"85":107,"86":52,"87":101,"88":57,"89":50,"90":118,"91":53,"92":18,"93":52,"94":99,"95":111,"96":115,"97":109,"98":111,"99":115,"100":118,"101":97,"102":108,"103":111,"104":112,"105":101,"106":114,"107":49,"108":116,"109":102,"110":108,"111":107,"112":51,"113":48,"114":109,"115":113,"116":53,"117":118,"118":103,"119":113,"120":106,"121":100,"122":108,"123":121,"124":57,"125":50,"126":107,"127":107,"128":104,"129":104,"130":113,"131":51,"132":114,"133":97,"134":101,"135":118,"136":50,"137":104,"138":110,"139":122,"140":54,"141":101,"142":101,"143":116,"144":101,"145":51,"146":26,"147":16,"148":10,"149":5,"150":117,"151":97,"152":116,"153":111,"154":109,"155":18,"156":7,"157":51,"158":52,"159":56,"160":48,"161":48,"162":48,"163":48,"164":18,"165":21,"166":68,"167":101,"168":108,"169":101,"170":103,"171":97,"172":116,"173":101,"174":100,"175":32,"176":119,"177":105,"178":116,"179":104,"180":32,"181":69,"182":120,"183":111,"184":100,"185":117,"186":115,"187":18,"188":104,"189":10,"190":81,"191":10,"192":70,"193":10,"194":31,"195":47,"196":99,"197":111,"198":115,"199":109,"200":111,"201":115,"202":46,"203":99,"204":114,"205":121,"206":112,"207":116,"208":111,"209":46,"210":115,"211":101,"212":99,"213":112,"214":50,"215":53,"216":54,"217":107,"218":49,"219":46,"220":80,"221":117,"222":98,"223":75,"224":101,"225":121,"226":18,"227":35,"228":10,"229":33,"230":3,"231":42,"232":13,"233":21,"234":239,"235":181,"236":212,"237":15,"238":68,"239":127,"240":80,"241":244,"242":83,"243":45,"244":149,"245":197,"246":129,"247":29,"248":153,"249":33,"250":121,"251":86,"252":18,"253":63,"254":156,"255":189,"256":241,"257":51,"258":157,"259":25,"260":184,"261":52,"262":76,"263":18,"264":4,"265":10,"266":2,"267":8,"268":1,"269":24,"270":197,"271":11,"272":18,"273":19,"274":10,"275":13,"276":10,"277":5,"278":117,"279":97,"280":116,"281":111,"282":109,"283":18,"284":4,"285":57,"286":49,"287":55,"288":52,"289":16,"290":180,"291":229,"292":44,"293":26,"294":6
4,"295":106,"296":22,"297":244,"298":194,"299":21,"300":219,"301":78,"302":14,"303":20,"304":119,"305":29,"306":19,"307":13,"308":37,"309":213,"310":42,"311":96,"312":215,"313":195,"314":109,"315":98,"316":197,"317":100,"318":0,"319":83,"320":249,"321":186,"322":132,"323":206,"324":38,"325":51,"326":200,"327":83,"328":83,"329":160,"330":32,"331":137,"332":51,"333":208,"334":206,"335":170,"336":99,"337":40,"338":104
,"339":204,"340":247,"341":205,"342":55,"343":161,"344":148,"345":84,"346":140,"347":200,"348":168,"349":94,"350":105,"351":40,"352":116,"353":64,"354":26,"355":161,"356":60,"357":146,"358":109},{"0":10,"1":148,"2":1,"3":10,"4":145,"5":1,"6":10,"7":28,"8":47,"9":99,"10":111,"11":115,"12":109,"13":111,"14":115,"15":46,"16":98,"17":97,"18":110,"19":107,"20":46,"21":118,"22":49,"23":98,"24":101,"25":116,"26":97,"27":4
9,"28":46,"29":77,"30":115,"31":103,"32":83,"33":101,"34":110,"35":100,"36":18,"37":113,"38":10,"39":45,"40":99,"41":111,"42":115,"43":109,"44":111,"45":115,"46":49,"47":48,"48":112,"49":103,"50":100,"51":114,"52":109,"53":110,"54":107,"55":119,"56":50,"57":57,"58":109,"59":117,"60":99,"61":56,"62":99,"63":107,"64":57,"65":114,"66":118,"67":54,"68":108,"69":108,"70":99,"71":121,"72":56,"73":115,"74":104,"75":113,"7
6":110,"77":99,"78":101,"79":56,"80":120,"81":48,"82":114,"83":122,"84":102,"85":18,"86":45,"87":99,"88":111,"89":115,"90":109,"91":111,"92":115,"93":49,"94":56,"95":117,"96":107,"97":108,"98":121,"99":114,"100":54,"101":107,"102":54,"103":107,"104":106,"105":119,"106":118,"107":104,"108":54,"109":104,"110":52,"111":99,"112":117,"113":118,"114":53,"115":119,"116":120,"117":50,"118":119,"119":100,"120":101,"121":122
,"122":50,"123":48,"124":104,"125":108,"126":48,"127":102,"128":51,"129":57,"130":101,"131":108,"132":26,"133":17,"134":10,"135":5,"136":117,"137":97,"138":116,"139":111,"140":109,"141":18,"142":8,"143":51,"144":48,"145":48,"146":48,"147":48,"148":48,"149":48,"150":48,"151":18,"152":103,"153":10,"154":81,"155":10,"156":70,"157":10,"158":31,"159":47,"160":99,"161":111,"162":115,"163":109,"164":111,"165":115,"166":46
,"167":99,"168":114,"169":121,"170":112,"171":116,"172":111,"173":46,"174":115,"175":101,"176":99,"177":112,"178":50,"179":53,"180":54,"181":107,"182":49,"183":46,"184":80,"185":117,"186":98,"187":75,"188":101,"189":121,"190":18,"191":35,"192":10,"193":33,"194":2,"195":29,"196":96,"197":145,"198":81,"199":165,"200":225,"201":22,"202":194,"203":114,"204":162,"205":146,"206":192,"207":202,"208":224,"209":58,"210":10,
"211":66,"212":101,"213":21,"214":77,"215":20,"216":189,"217":13,"218":253,"219":59,"220":41,"221":95,"222":106,"223":150,"224":33,"225":68,"226":47,"227":18,"228":4,"229":10,"230":2,"231":8,"232":127,"233":24,"234":174,"235":1,"236":18,"237":18,"238":10,"239":12,"240":10,"241":5,"242":117,"243":97,"244":116,"245":111,"246":109,"247":18,"248":3,"249":57,"250":51,"251":57,"252":16,"253":149,"254":198,"255":9,"256":2
6,"257":64,"258":141,"259":186,"260":180,"261":214,"262":210,"263":98,"264":121,"265":65,"266":8,"267":22,"268":5,"269":124,"270":98,"271":229,"272":118,"273":9,"274":103,"275":167,"276":86,"277":114,"278":232,"279":10,"280":142,"281":222,"282":114,"283":234,"284":215,"285":223,"286":253,"287":231,"288":246,"289":95,"290":81,"291":74,"292":73,"293":20,"294":20,"295":149,"296":68,"297":202,"298":126,"299":236,"300":
49,"301":186,"302":120,"303":210,"304":60,"305":99,"306":101,"307":105,"308":233,"309":35,"310":166,"311":207,"312":42,"313":74,"314":179,"315":1,"316":153,"317":113,"318":120,"319":95,"320":132,"321":160},{"0":10,"1":198,"2":2,"3":10,"4":160,"5":1,"6":10,"7":55,"8":47,"9":99,"10":111,"11":115,"12":109,"13":111,"14":115,"15":46,"16":100,"17":105,"18":115,"19":116,"20":114,"21":105,"22":98,"23":117,"24":116,"25":105
,"26":111,"27":110,"28":46,"29":118,"30":49,"31":98,"32":101,"33":116,"34":97,"35":49,"36":46,"37":77,"38":115,"39":103,"40":87,"41":105,"42":116,"43":104,"44":100,"45":114,"46":97,"47":119,"48":68,"49":101,"50":108,"51":101,"52":103,"53":97,"54":116,"55":111,"56":114,"57":82,"58":101,"59":119,"60":97,"61":114,"62":100,"63":18,"64":101,"65":10,"66":45,"67":99,"68":111,"69":115,"70":109,"71":111,"72":115,"73":49,"74
":56,"75":102,"76":120,"77":112,"78":57,"79":118,"80":99,"81":52,"82":99,"83":108,"84":119,"85":100,"86":113,"87":120,"88":116,"89":97,"90":54,"91":54,"92":114,"93":55,"94":122,"95":116,"96":48,"97":114,"98":122,"99":51,"100":97,"101":121,"102":51,"103":122,"104":116,"105":52,"106":50,"107":102,"108":51,"109":114,"110":48,"111":52,"112":18,"113":52,"114":99,"115":111,"116":115,"117":109,"118":111,"119":115,"120":11
8,"121":97,"122":108,"123":111,"124":112,"125":101,"126":114,"127":49,"128":104,"129":109,"130":100,"131":53,"132":51,"133":53,"134":102,"135":54,"136":57,"137":116,"138":51,"139":120,"140":50,"141":54,"142":50,"143":109,"144":54,"145":115,"146":57,"147":119,"148":99,"149":54,"150":106,"151":100,"152":48,"153":100,"154":109,"155":101,"156":108,"157":50,"158":122,"159":101,"160":118,"161":104,"162":121,"163":117,"16
4":104,"165":109,"166":10,"167":160,"168":1,"169":10,"170":55,"171":47,"172":99,"173":111,"174":115,"175":109,"176":111,"177":115,"178":46,"179":100,"180":105,"181":115,"182":116,"183":114,"184":105,"185":98,"186":117,"187":116,"188":105,"189":111,"190":110,"191":46,"192":118,"193":49,"194":98,"195":101,"196":116,"197":97,"198":49,"199":46,"200":77,"201":115,"202":103,"203":87,"204":105,"205":116,"206":104,"207":10
0,"208":114,"209":97,"210":119,"211":68,"212":101,"213":108,"214":101,"215":103,"216":97,"217":116,"218":111,"219":114,"220":82,"221":101,"222":119,"223":97,"224":114,"225":100,"226":18,"227":101,"228":10,"229":45,"230":99,"231":111,"232":115,"233":109,"234":111,"235":115,"236":49,"237":56,"238":102,"239":120,"240":112,"241":57,"242":118,"243":99,"244":52,"245":99,"246":108,"247":119,"248":100,"249":113,"250":120,"
251":116,"252":97,"253":54,"254":54,"255":114,"256":55,"257":122,"258":116,"259":48,"260":114,"261":122,"262":51,"263":97,"264":121,"265":51,"266":122,"267":116,"268":52,"269":50,"270":102,"271":51,"272":114,"273":48,"274":52,"275":18,"276":52,"277":99,"278":111,"279":115,"280":109,"281":111,"282":115,"283":118,"284":97,"285":108,"286":111,"287":112,"288":101,"289":114,"290":49,"291":101,"292":121,"293":54,"294":57
,"295":114,"296":51,"297":55,"298":103,"299":102,"300":120,"301":118,"302":120,"303":103,"304":54,"305":50,"306":115,"307":104,"308":52,"309":114,"310":48,"311":107,"312":116,"313":112,"314":117,"315":99,"316":52,"317":54,"318":112,"319":122,"320":106,"321":114,"322":109,"323":56,"324":55,"325":51,"326":97,"327":101,"328":56,"329":18,"330":103,"331":10,"332":80,"333":10,"334":70,"335":10,"336":31,"337":47,"338":99,
"339":111,"340":115,"341":109,"342":111,"343":115,"344":46,"345":99,"346":114,"347":121,"348":112,"349":116,"350":111,"351":46,"352":115,"353":101,"354":99,"355":112,"356":50,"357":53,"358":54,"359":107,"360":49,"361":46,"362":80,"363":117,"364":98,"365":75,"366":101,"367":121,"368":18,"369":35,"370":10,"371":33,"372":2,"373":2,"374":192,"375":55,"376":218,"377":194,"378":2,"379":90,"380":45,"381":190,"382":147,"38
3":110,"384":197,"385":162,"386":55,"387":16,"388":74,"389":100,"390":147,"391":91,"392":12,"393":181,"394":200,"395":220,"396":222,"397":115,"398":74,"399":170,"400":105,"401":184,"402":191,"403":208,"404":217,"405":18,"406":4,"407":10,"408":2,"409":8,"410":127,"411":24,"412":9,"413":18,"414":19,"415":10,"416":13,"417":10,"418":5,"419":117,"420":97,"421":116,"422":111,"423":109,"424":18,"425":4,"426":56,"427":56,"
428":50,"429":51,"430":16,"431":188,"432":223,"433":89,"434":26,"435":64,"436":51,"437":123,"438":133,"439":0,"440":146,"441":97,"442":188,"443":99,"444":251,"445":206,"446":206,"447":7,"448":143,"449":141,"450":117,"451":199,"452":160,"453":118,"454":190,"455":39,"456":17,"457":34,"458":99,"459":230,"460":28,"461":0,"462":177,"463":64,"464":97,"465":236,"466":255,"467":2,"468":15,"469":241,"470":43,"471":84,"472":89,"473":137,"474":172,"475":220,"476":100,"477":108,"478":209,"479":170,"480":97,"481":213,"482":80,"483":127,"484":170,"485":73,"486":177,"487":210,"488":164,"489":26,"490":98,"491":228,"492":68,"493":27,"494":116,"495":18,"496":159,"497":165,"498":170,"499":55}]}`)
    });
  });

  describe("parseTransaction", () => {
    it("should decode a transaction and extract hash and messages", () => {
      const mockTx = Tx.fromPartial({
        body: {
          messages: [{ typeUrl: "/cosmos.bank.v1beta1.MsgSend" }],
        },
      });

      const encodedTx = Tx.encode(mockTx).finish();
      const parsed = parseTransaction(encodedTx);

      expect(parsed).toEqual({
        messages: ["/cosmos.bank.v1beta1.MsgSend"],
        hash: toHex(sha256(encodedTx)),
      });
    });
  });

  describe("getTransactionData", () => {
    it("should fetch transaction data from StargateClient", async () => {
      const txHash = 'f8771c7aac9c03a69b4fd1fea9c1deda4559767127f8d2e21b0b6a300e5cba7c';
      const txData = await getTransactionData(txHash);

      expect(txData?.height === 23574728)
      expect(txData?.hash === 'F8771C7AAC9C03A69B4FD1FEA9C1DEDA4559767127F8D2E21B0B6A300E5CBA7C')
      expect(txData.code === 0)
      expect(JSON.stringify(txData?.events) === `[{"type":"tx","attributes":[{"key":"acc_seq","value":"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp/9"}]},{"type":"tx","attributes":[{"key":"signature","value":"Bvj29i6oX5y7Y7t6Tb236+pF/XvGOqRzvuNLwqbJsGlJKtgFxzKoj2MEniPwFeu8vq6YhpaF9Yvbn3gWVhRe/A=="}]},{"type":"coin_spent","attributes":[{"key":"spender","value":"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp"},{"key":"amount","value":"1065uatom"}]},{"type":"coin_received","attributes":[{"key":"receiver","value":"cosmos13pxn9n3qw79e03844rdadagmg0nshmwf7qvuye"},{"key":"amount","value":"1065uatom"}]},{"type":"transfer","attributes":[{"key":"recipient","value":"cosmos13pxn9n3qw79e03844rdadagmg0nshmwf7qvuye"},{"key":"sender","value":"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp"},{"key":"amount","value":"1065uatom"}]},{"type":"message","attributes":[{"key":"sender","value":"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp"}]},{"type":"message","attributes":[{"key":"action","value":"/ibc.applications.transfer.v1.MsgTransfer"},{"key":"sender","value":"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp"},{"key":"msg_index","value":"0"}]},{"type":"coin_spent","attributes":[{"key":"spender","value":"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp"},{"key":"amount","value":"10000uatom"},{"key":"msg_index","value":"0"}]},{"type":"coin_received","attributes":[{"key":"receiver","value":"cosmos1tvlnmx73we26klghmcleehr880q96cf3nd4zm4"},{"key":"amount","value":"10000uatom"},{"key":"msg_index","value":"0"}]},{"type":"transfer","attributes":[{"key":"recipient","value":"cosmos1tvlnmx73we26klghmcleehr880q96cf3nd4zm4"},{"key":"sender","value":"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp"},{"key":"amount","value":"10000uatom"},{"key":"msg_index","value":"0"}]},{"type":"message","attributes":[{"key":"sender","value":"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp"},{"key":"msg_index","value":"0"}]},{"type":"send_packet","attributes":[{"key":"packet_data","value":"{\\"amount\\":\\"10000\\",\\"denom\\":\\"uatom\\",\\"receiver\\":\\"elys1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6spfr\\",\\"sender\\":\\"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp\\"}"},{"key":"packet_data_hex","value":"7b22616d6f756e74223a223130303030222c2264656e6f6d223a227561746f6d222c227265636569766572223a22656c797331777863337564376532793779306879707938357638726e7536363465346b6434793673706672222c2273656e646572223a22636f736d6f7331777863337564376532793779306879707938357638726e7536363465346b6434793666787970227d"},{"key":"packet_timeout_height","value":"0-0"},{"key":"packet_timeout_timestamp","value":"1734575771000000000"},{"key":"packet_sequence","value":"15548"},{"key":"packet_src_port","value":"transfer"},{"key":"packet_src_channel","value":"channel-1266"},{"key":"packet_dst_port","value":"transfer"},{"key":"packet_dst_channel","value":"channel-1"},{"key":"packet_channel_ordering","value":"ORDER_UNORDERED"},{"key":"packet_connection","value":"connection-1073"},{"key":"connection_id","value":"connection-1073"},{"key":"msg_index","value":"0"}]},{"type":"message","attributes":[{"key":"module","value":"ibc_channel"},{"key":"msg_index","value":"0"}]},{"type":"ibc_transfer","attributes":[{"key":"sender","value":"cosmos1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6fxyp"},{"key":"receiver","value":"elys1wxc3ud7e2y7y0hypy85v8rnu664e4kd4y6spfr"},{"key":"amount","value":"10000"},{"key":"denom","value":"uatom"},{"key":"memo","value":""},{"key":"msg_index","value":"0"}]},{"type":"message","attributes":[{"key":"module","value":"transfer"},{"key":"msg_index","value":"0"}]},{"type":"coin_spent","attributes":[{"key":"spender","value":"cosmos13pxn9n3qw79e03844rdadagmg0nshmwf7qvuye"},{"key":"amount","value":"493uatom"}]},{"type":"coin_received","attributes":[{"key":"receiver","value":"cosmos1tfvaep6xl4e8lhw4e06uhwgvdaskenumx3gcwg"},{"key":"amount","value":"493uatom"}]},{"type":"transfer","attributes":[{"key":"recipient","value":"cosmos1tfvaep6xl4e8lhw4e06uhwgvdaskenumx3gcwg"},{"key":"sender","value":"cosmos13pxn9n3qw79e03844rdadagmg0nshmwf7qvuye"},{"key":"amount","value":"493uatom"}]},{"type":"message","attributes":[{"key":"sender","value":"cosmos13pxn9n3qw79e03844rdadagmg0nshmwf7qvuye"}]},{"type":"fee_pay","attributes":[{"key":"fee","value":"572uatom"}]},{"type":"tip_pay","attributes":[{"key":"tip","value":"493uatom"},{"key":"tip_payee","value":"cosmos1tfvaep6xl4e8lhw4e06uhwgvdaskenumx3gcwg"}]}]`)
      expect(txData?.gasUsed === 135556n)
      expect(txData?.gasWanted === 177456n)
      expect(JSON.stringify(txData?.msgResponses) === '[{"typeUrl":"/ibc.applications.transfer.v1.MsgTransferResponse","value":{"0":8,"1":188,"2":121}}]')
    });

    it("should throw error when transaction hash is invalid", async () => {
      const txHash = 'invalid';
      await expect(getTransactionData(txHash)).rejects.toThrowError('{"code":-32603,"message":"Internal error","data":"error during searching for a hash in the query: encoding/hex: invalid byte: U+0069 \'i\'"}')
    });
  });
});
